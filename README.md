# KakuDraft

KakuDraft は、ブラウザだけで使える日本語向け執筆アプリです。  
本文編集、メモ（添付付き）、AI支援、GitHubバックアップを1つにまとめています。

## 主な機能

- 章（話）ごとの本文執筆
- 各話/フォルダー/全体メモ
- 添付ファイル（画像・音声・動画・テキスト）
- AIチャット/校閲（OpenRouter, Groq, Google）
- GitHub へのバックアップ・復元
- スナップショット保存
- 検索/置換、統計表示

## AI機能

- MENU の **AIタブ** で以下を設定できます。
  - プロバイダ
  - APIキー
  - モデル
  - 無料モデルのみ（OpenRouter）
- AI応答の `usage` / `usageMetadata` が取得できる場合、AI使用量として表示します。
- AIチャットのMarkdownは、見出し・リスト・コードブロック・テーブル表示に対応しています。

## GitHub同期（新形式）

バックアップは用途別に分割して保存します。

- `設定/settings.json`
- `キー類/keys.json`
- `話/stories.json`
- `メモ/memos.json`
- `話/ai_chat.json`
- `設定/sync_metadata.json`

### 差分同期

- アップロード時は、クラウド内容と比較して**変更があるファイルのみ**更新します。
- 通信量削減と同期エラー低減を目的としています。

### 旧形式からの移行

旧形式（`kakudraft_data.json`, `kakudraft_ai_chat.json`）がGitHub上にある場合、同期時に新形式へ自動移行します。

## 起動時のクラウド確認

オンラインかつGitHub設定済みの場合、起動時に `sync_metadata` を確認し、クラウドの方が新しければ取得するか確認します。

## ローカル保存

- IndexedDB を利用して状態を保存します。
- 旧保存キー（`localStorage`）が残っている場合は初回ロード時に移行されます。

## 使い方（最短）

1. `index.html` をブラウザで開く
2. MENU → バックアップ で GitHub PAT / Repo / 端末名を入力
3. `UP` でクラウド保存、`DOWN` で復元

## 注意

- APIキー類は暗号化状態でアプリデータに含まれ、バックアップ対象になります。
- GitHub APIのレート制限・権限設定により同期が失敗する場合があります。
